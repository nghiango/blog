<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/452439ea424eb324.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/452439ea424eb324.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-10fac88913917d91.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-f6794ce844a6ac09.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-6e17f03185c56a9c.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/1bfc9850-bcfa9f06df43326e.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/336-7d938e397f67c7a4.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/security/%5Bslug%5D-e0dff521ee29f738.js" defer="" crossorigin=""></script><script src="/_next/static/V9_ih7ccd-3N_YuoUMSNK/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/V9_ih7ccd-3N_YuoUMSNK/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="page__container"><div class="fixed bg-white w-full z-10"><div class="mx-auto px-4 sm:px-6 position-fixed"><div class="flex items-center border-b-2 border-gray-100 py-6 md:justify-start md:space-x-10"><div class="flex justify-start"><div class="relative"><a href="/"><span class="text-gray-500 cursor-pointer group bg-white rounded-md inline-flex items-center text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true" class="h-9 w-9 mr-2"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg> <span class="text-xl pt-1">HOME</span></span></a></div></div><nav class="hidden md:flex space-x-10"><div class="relative"><button class="text-gray-500 group bg-white rounded-md inline-flex items-center text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" id="headlessui-popover-button-undefined" type="button" aria-expanded="false"><span>Devs Document</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div></nav><nav class="hidden md:flex space-x-10"><div class="relative"><button class="text-gray-500 group bg-white rounded-md inline-flex items-center text-base font-medium hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" id="headlessui-popover-button-undefined" type="button" aria-expanded="false"><a href="/info/about-me"><span>About me</span></a></button></div></nav></div></div></div><main class="container w-100 lg:w-8/12 mx-auto flex flex-col pb-16 pt-40"><div class="card card-page"><div class="post__header"><h1 class="post__title post--padding">How to simulate AES256 of Jasypt</h1><div class="post__author post--padding"><p>By <span class="font-bold"></span></p><span class="text-sm">Jun 23, 2022</span></div><img class="post__image-cover" src="/images/posts/img5.jpg" alt="image-cover"/></div><div class="post__body post--padding"><p class=" code-block__paragraph">Jasypt is a lib of Java that has some function of decrypt and encrypt a sensitive information. It is fine if we are only using Java project to encrypt and decrypt sensitive information. However, how about if the sensitive information is encrypted in Java and decrypt in NodeJs project which only has crypto as a cryptographic provider but not specific for AES256, especially the default AES256 of Jasypt.</p>
<p class=" code-block__paragraph">To simulate it, we need to define some values that Jasypt uses to encrypt and decrypt.</p>
<ul>
<li>Argument: &#x27;aes-256-cbc&#x27;</li>
<li>Interations pbkdf2 = 1000</li>
<li>key lenth pbkdf2 = 32</li>
<li>digest pbkdf2 = sha512</li>
</ul>
<pre><div class="code-block__block"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" class="code-block__copy-func" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"></path></svg><pre style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-js" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token doc-comment" style="color:#546e7a">/** Function serve Jasypt text: http://www.jasypt.org/encrypting-texts.html
</span><span class="token token doc-comment" style="color:#546e7a"> * With default config:
</span><span class="token token doc-comment" style="color:#546e7a"> * - Algorithm: PBEWithHmacSHA512AndAES_256
</span><span class="token token doc-comment" style="color:#546e7a"> * - Salt: RandomSaltGenerator
</span><span class="token token doc-comment" style="color:#546e7a"> * - Iv: RandomIvGenerator
</span><span class="token token doc-comment" style="color:#546e7a">**/</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> crypto </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">require</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;crypto&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#89ddff">{</span><span> encryptionPassword </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">require</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;../../config/env&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#c792ea">ARGUMENT</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;aes-256-cbc&#x27;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#c792ea">ITERATIONS_PBKDF2</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#fd9170">1000</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#c792ea">KEY_LENGTH_PBKDF2</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#fd9170">32</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#c792ea">DIGEST_PBKDF2</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;sha512&#x27;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#c792ea">BASE64</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;base64&#x27;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#c792ea">UTF8</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;utf8&#x27;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#c792ea">ENCRYPTION_PASSWORD_PROJECT</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;psd2-consent-mgmt&#x27;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> decryptedEncryptionPassword </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;&#x27;</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">encrypt</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">sensitiveString</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> salt </span><span class="token token" style="color:#89ddff">=</span><span> crypto</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">randomBytes</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">16</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> realEncryptionKey </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">ENCRYPTION_PASSWORD_PROJECT</span><span class="token token" style="color:#89ddff">;</span><span>
</span>  
<span>  </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>decryptedEncryptionPassword</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    realEncryptionKey </span><span class="token token" style="color:#89ddff">=</span><span> decryptedEncryptionPassword</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#89ddff">}</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> key </span><span class="token token" style="color:#89ddff">=</span><span> crypto</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">pbkdf2Sync</span><span class="token token" style="color:#89ddff">(</span><span>realEncryptionKey</span><span class="token token" style="color:#89ddff">,</span><span> salt</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">ITERATIONS_PBKDF2</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">KEY_LENGTH_PBKDF2</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">DIGEST_PBKDF2</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> iv </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">Buffer</span><span class="token token" style="color:#89ddff">(</span><span>crypto</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">randomBytes</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">16</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">UTF8</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> cipher </span><span class="token token" style="color:#89ddff">=</span><span> crypto</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">createCipheriv</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">ARGUMENT</span><span class="token token" style="color:#89ddff">,</span><span> key</span><span class="token token" style="color:#89ddff">,</span><span> iv</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> encrypted </span><span class="token token" style="color:#89ddff">=</span><span> cipher</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">update</span><span class="token token" style="color:#89ddff">(</span><span>sensitiveString</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  encrypted </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token maybe-class-name">Buffer</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">concat</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">[</span><span>encrypted</span><span class="token token" style="color:#89ddff">,</span><span> cipher</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">final</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">]</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  encrypted </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token maybe-class-name">Buffer</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">concat</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">[</span><span>iv</span><span class="token token" style="color:#89ddff">,</span><span> encrypted</span><span class="token token" style="color:#89ddff">]</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  encrypted </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token maybe-class-name">Buffer</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">concat</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">[</span><span>salt</span><span class="token token" style="color:#89ddff">,</span><span> encrypted</span><span class="token token" style="color:#89ddff">]</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> encrypted</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">toString</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">BASE64</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<!-- -->
<span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">decrypt</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">encryptedString</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> bufferEncryptedStr </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token maybe-class-name">Buffer</span><span class="token token" style="color:#89ddff">.</span><span class="token token module" style="color:#c792ea;font-style:italic">from</span><span class="token token" style="color:#89ddff">(</span><span>encryptedString</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">BASE64</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> salt </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">Buffer</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">16</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#546e7a">// Follow the implementation of Jasypt, the first 16 bytes are salt</span><span>
</span><span>  bufferEncryptedStr</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">copy</span><span class="token token" style="color:#89ddff">(</span><span>salt</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">16</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> iv </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">Buffer</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">16</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#546e7a">// Follow the implementation of Jasypt, the next 16 bytes are IV</span><span>
</span><span>  bufferEncryptedStr</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">copy</span><span class="token token" style="color:#89ddff">(</span><span>iv</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">16</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">32</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> bufferLength </span><span class="token token" style="color:#89ddff">=</span><span> bufferEncryptedStr</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">length</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> sensitiveEncrypted </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">Buffer</span><span class="token token" style="color:#89ddff">(</span><span>bufferLength </span><span class="token token" style="color:#89ddff">-</span><span> </span><span class="token token" style="color:#fd9170">32</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#546e7a">// Follow the implementation of Jasypt, the rest bytes are sensitiveEncrypted</span><span>
</span><span>  bufferEncryptedStr</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">copy</span><span class="token token" style="color:#89ddff">(</span><span>sensitiveEncrypted</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">32</span><span class="token token" style="color:#89ddff">,</span><span> bufferLength</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>  
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> realEncryptionKey </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">ENCRYPTION_PASSWORD_PROJECT</span><span class="token token" style="color:#89ddff">;</span><span>
</span>  
<span>  </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>decryptedEncryptionPassword</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    realEncryptionKey </span><span class="token token" style="color:#89ddff">=</span><span> decryptedEncryptionPassword</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> key </span><span class="token token" style="color:#89ddff">=</span><span> crypto</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">pbkdf2Sync</span><span class="token token" style="color:#89ddff">(</span><span>realEncryptionKey</span><span class="token token" style="color:#89ddff">,</span><span> salt</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">ITERATIONS_PBKDF2</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">KEY_LENGTH_PBKDF2</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">DIGEST_PBKDF2</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> decipher </span><span class="token token" style="color:#89ddff">=</span><span> crypto</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">createDecipheriv</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">ARGUMENT</span><span class="token token" style="color:#89ddff">,</span><span> key</span><span class="token token" style="color:#89ddff">,</span><span> iv</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> decrypted</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  decrypted </span><span class="token token" style="color:#89ddff">=</span><span> decipher</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">update</span><span class="token token" style="color:#89ddff">(</span><span>sensitiveEncrypted</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  decrypted </span><span class="token token" style="color:#89ddff">+=</span><span> decipher</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">final</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">UTF8</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> decrypted</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>decryptedEncryptionPassword </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">decrypt</span><span class="token token" style="color:#89ddff">(</span><span>encryptionPassword</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>module</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">exports</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>  encrypt</span><span class="token token" style="color:#89ddff">,</span><span>
</span>  decrypt
<span></span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">;</span><span>
</span></code></pre></div></pre></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"frontmatter":{"title":"How to simulate AES256 of Jasypt","date":"Jun 23, 2022","excerpt":"Crash course to learn the React JavaScript library. We will look at components, hooks and more","tag":"Nodejs","cover_image":"/images/posts/img5.jpg"},"slug":"how-to-simulate-aes256-jasypt","content":"\r\nJasypt is a lib of Java that has some function of decrypt and encrypt a sensitive information. It is fine if we are only using Java project to encrypt and decrypt sensitive information. However, how about if the sensitive information is encrypted in Java and decrypt in NodeJs project which only has crypto as a cryptographic provider but not specific for AES256, especially the default AES256 of Jasypt.\r\n\r\nTo simulate it, we need to define some values that Jasypt uses to encrypt and decrypt.\r\n\r\n- Argument: 'aes-256-cbc'\r\n- Interations pbkdf2 = 1000\r\n- key lenth pbkdf2 = 32\r\n- digest pbkdf2 = sha512\r\n\r\n```js\r\n/** Function serve Jasypt text: http://www.jasypt.org/encrypting-texts.html\r\n * With default config:\r\n * - Algorithm: PBEWithHmacSHA512AndAES_256\r\n * - Salt: RandomSaltGenerator\r\n * - Iv: RandomIvGenerator\r\n**/\r\nconst crypto = require('crypto');\r\nconst { encryptionPassword } = require('../../config/env');\r\nconst ARGUMENT = 'aes-256-cbc';\r\nconst ITERATIONS_PBKDF2 = 1000;\r\nconst KEY_LENGTH_PBKDF2 = 32;\r\nconst DIGEST_PBKDF2 = 'sha512';\r\nconst BASE64 = 'base64';\r\nconst UTF8 = 'utf8';\r\nconst ENCRYPTION_PASSWORD_PROJECT = 'psd2-consent-mgmt';\r\nlet decryptedEncryptionPassword = '';\r\n\r\nconst encrypt = (sensitiveString) =\u003e {\r\n  const salt = crypto.randomBytes(16);\r\n\r\n  let realEncryptionKey = ENCRYPTION_PASSWORD_PROJECT;\r\n  \r\n  if (decryptedEncryptionPassword) {\r\n    realEncryptionKey = decryptedEncryptionPassword;\r\n  }\r\n\r\n  const key = crypto.pbkdf2Sync(realEncryptionKey, salt, ITERATIONS_PBKDF2, KEY_LENGTH_PBKDF2, DIGEST_PBKDF2);\r\n\r\n  const iv = new Buffer(crypto.randomBytes(16), UTF8);\r\n\r\n  const cipher = crypto.createCipheriv(ARGUMENT, key, iv);\r\n\r\n  let encrypted = cipher.update(sensitiveString);\r\n\r\n  encrypted = Buffer.concat([encrypted, cipher.final()]);\r\n  encrypted = Buffer.concat([iv, encrypted]);\r\n  encrypted = Buffer.concat([salt, encrypted]);\r\n\r\n  return encrypted.toString(BASE64);\r\n};\r\n\r\n\r\nconst decrypt = (encryptedString) =\u003e {\r\n  const bufferEncryptedStr = Buffer.from(encryptedString, BASE64);\r\n  const salt = new Buffer(16);\r\n  // Follow the implementation of Jasypt, the first 16 bytes are salt\r\n  bufferEncryptedStr.copy(salt, 0, 0, 16);\r\n\r\n  const iv = new Buffer(16);\r\n  // Follow the implementation of Jasypt, the next 16 bytes are IV\r\n  bufferEncryptedStr.copy(iv, 0, 16, 32);\r\n\r\n  const bufferLength = bufferEncryptedStr.length;\r\n  const sensitiveEncrypted = new Buffer(bufferLength - 32);\r\n  // Follow the implementation of Jasypt, the rest bytes are sensitiveEncrypted\r\n  bufferEncryptedStr.copy(sensitiveEncrypted, 0, 32, bufferLength);\r\n  \r\n  let realEncryptionKey = ENCRYPTION_PASSWORD_PROJECT;\r\n  \r\n  if (decryptedEncryptionPassword) {\r\n    realEncryptionKey = decryptedEncryptionPassword;\r\n  }\r\n  const key = crypto.pbkdf2Sync(realEncryptionKey, salt, ITERATIONS_PBKDF2, KEY_LENGTH_PBKDF2, DIGEST_PBKDF2);\r\n\r\n  const decipher = crypto.createDecipheriv(ARGUMENT, key, iv);\r\n  let decrypted;\r\n  decrypted = decipher.update(sensitiveEncrypted);\r\n  decrypted += decipher.final(UTF8);\r\n  return decrypted;\r\n};\r\n\r\ndecryptedEncryptionPassword = decrypt(encryptionPassword);\r\n\r\nmodule.exports = {\r\n  encrypt,\r\n  decrypt\r\n};\r\n```"},"__N_SSG":true},"page":"/security/[slug]","query":{"slug":"how-to-simulate-aes256-jasypt"},"buildId":"V9_ih7ccd-3N_YuoUMSNK","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>